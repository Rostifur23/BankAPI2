<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>Select an Account</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    </head>
    <body>
        <div class="acc_container">
            <div class="accounts"></div>
            <button class="form_btn" id="create_account">Create New Bank Account</button>
            <div class="form_content">
                <form action="" method="POST">
                    <select id="acc_type">
                        <option value="current">Current</option>
                        <option value="savings">Savings</option>
                    </select>
                    <input class="form_btn" id="submitBtn" type="submit" value="Submit"/>
                </form>
            </div>
        </div>
    </body>
</html>
<script>
    $(document).ready(function(){
        
        $.ajax({
                type: 'GET',
                url: "http://localhost:8080/api/bankapp/user/session",
                dataType: 'json', // data type of response
                contenttype: 'application/json',
                success: function (data){
                    var uid = data;
                    console.log(uid);
                    if(uid == 0){
                        location.replace("http://localhost:8080");
                    }
                    
                }
                
            });
        
        $(".form_content").hide();
        
            $.ajax({
                type: 'GET',
                url: "http://localhost:8080/api/bankapp/accounts/",
                dataType: 'json', // data type of response
                contenttype: 'application/json',
                success: function (data){
                    // loop through data outputting each account
                    console.log(data);
                    var html = "";
                    for (i in data) {
                        // html = html+'<form><input class="form_btn" onclick="hello('+data[i].account_id+')" type="submit" value="'+data[i].account_type+' : '+data[i].account_num+'"/></form>';
                        html = html+'<button class="form_btn" onclick="hello('+data[i].account_id+')" type="submit">'+data[i].account_type+' : '+data[i].account_num+'</button>';
                    }
                    $(".accounts").html(html);
                    
                    
                }
                
            });
            
            $("#create_account").click(function(){
                $(".form_content").slideToggle( "slow", function() {
                    
                });
            });
            
            $("#submitBtn").click(function(){
                
                var account_type = $('#acc_type :selected').text();
                
                var account = '{"account_type":"'+account_type+'"}';
                
                    
                    $.ajax({
                        type: 'POST',
                        contentType: 'application/json',
                        url: "http://localhost:8080/api/bankapp/bank/account",
                        dataType: "json",
                        data: account
                        
                    });
                
            });
            
            
            
            
    });
    
            function hello(account_id){
                
                account = '{"id":"'+account_id+'"}';
                $.ajax({
                        type: 'POST',
                        contentType: 'application/json',
                        url: "http://localhost:8080/api/bankapp/bank/account/active",
                        dataType: "json",
                        data: account
                        
                    });
                    
                 location.replace("http://localhost:8080/dashboard.html");
            }
</script>
